<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Usable Floor Area Diagnostic Tool</title>
    <style>
        body { margin: 0; font-family: sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; }
        #info { text-align: center; color: black; font-size: 1.5em; padding: 2em; border: 2px solid #ccc; border-radius: 10px; }
    </style>
</head>
<body>
    <div id="info">Running diagnostics...<br>Please open the F12 Developer Console.</div>

    <script type="importmap">
        { "imports": { "three": "https://unpkg.com/three@0.163.0/build/three.module.js", "three/addons/": "https://unpkg.com/three@0.163.0/examples/jsm/" } }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { OBJLoader } from 'three/addons/loaders/OBJLoader.js';

        const infoDiv = document.getElementById('info');
        console.log("--- Starting Usable Floor Area Diagnostic ---");

        try {
            const loader = new OBJLoader();
            const objFileName = 'FloorPlan_Hydro.obj';

            loader.load(
                objFileName,
                function (object) {
                    let totalUsableArea = 0;
                    const floorDetails = [];

                    // Iterate through all parts of the loaded model
                    object.traverse(function (child) {
                        // We are looking for Meshes that are named 'Floor_...' which is standard for Sweet Home 3D floors
                        if (child instanceof THREE.Mesh && child.name.startsWith('Floor_')) {
                            
                            // Calculate the size (dimensions) of this floor piece
                            const box = new THREE.Box3().setFromObject(child);
                            const size = box.getSize(new THREE.Vector3());

                            // The area of a horizontal floor is its width (x) times its depth (z)
                            // We divide by 10000 to convert from cm^2 (SH3D's default) to m^2
                            const area = (size.x * size.z) / 10000;
                            totalUsableArea += area;

                            floorDetails.push({
                                name: child.name,
                                width_m: (size.x / 100).toFixed(2),
                                depth_m: (size.z / 100).toFixed(2),
                                area_m2: area.toFixed(2)
                            });
                        }
                    });

                    // --- THIS IS THE CRUCIAL PART ---
                    console.log("--- DIAGNOSTIC RESULTS ---");
                    console.log("Model Loaded Successfully.");
                    console.table(floorDetails); // A clean table of each floor piece found
                    console.log(`TOTAL USABLE FLOOR AREA: ${totalUsableArea.toFixed(2)} square meters.`);
                    console.log("--------------------------");

                    infoDiv.innerHTML = `<strong style="color: green;">Diagnostic Complete!</strong><br>Please copy the full output from the F12 developer console and send it back to me.`;
                },
                function (xhr) {
                    if (xhr.lengthComputable) {
                        infoDiv.textContent = `Loading: ${(xhr.loaded / xhr.total * 100).toFixed(2)}%`;
                    }
                },
                function (error) {
                    console.error('An error happened during OBJ loading:', error);
                    infoDiv.innerHTML = `<span style="color: red;"><strong>Error:</strong> Could not load the OBJ file. Check the browser console (F12) for a 404 error.</span>`;
                }
            );
        } catch(e) {
            console.error("A critical error occurred:", e);
            infoDiv.innerHTML = `<span style="color: red;"><strong>Critical Error:</strong> ${e.message}</span>`;
        }
    </script>
</body>
</html>